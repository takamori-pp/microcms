---
// src/pages/index.astro
import { client } from "../lib/microcms";
import Header from "./header.astro";

// microCMSから「categories」というエンドポイントのデータを取得
const response_cat = await client.get({ 
  endpoint: "categories", // あなたがmicroCMSで作ったエンドポイント名に変更
  queries: { fields: ["id", "name"] } 
});
// microCMSから「info」というエンドポイントのデータを取得
const response = await client.get({ 
  endpoint: "info", // あなたがmicroCMSで作ったエンドポイント名に変更
  queries: { fields: ["id", "title"] } 
});
// microCMSから「info」というエンドポイントのデータを取得
const response_campaign = await client.get({ 
  endpoint: "info?filter=campaign[equals]true", // あなたがmicroCMSで作ったエンドポイント名に変更
  queries: { fields: ["id", "title"] } 
});

import '../styles/style.css';

---

<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
</head>
  <body>
    <Header />
    <div class="p-flyer">
      <div class="p-flyer__inner inner">

      <div class="p-info__cats">
        <h2>カテゴリ一覧</h2>
        <div>
          <ul class="p-info__cats-flex c-flex">
            {
              response_cat.contents.map((post: any) => (
                <li>
                  <a href={`./cat/${post.id}.html`}>{post.name}</a>
                </li>
              ))
            }
          </ul>
        </div>
      </div>
    
        <h1>期間限定一覧</h1>
        <ul class="p-flyer__flex">
          {
            response_campaign.contents.map((post: any) => (
              <li class="p-flyer__box">
                <a href={`./blog/${post.id}.html`}>{post.title}</a>
              </li>
            ))
          }
        </ul>
        <h1>記事一覧</h1>
        <ul class="p-flyer__flex">
          {
            response.contents.map((post: any) => (
              <li class="p-flyer__box">
                <a href={`./blog/${post.id}.html`}>{post.title}</a>
              </li>
            ))
          }
        </ul>

        <h1>牛一覧</h1>
        <div class="p-flyer__flex">
          <ul id="article-list"></ul>
        </div>
        <a href="./store.html">store</a>
      </div>
    </div>
    <footer id="footer"></footer>
    <script src="./script/script.js" is:inline></script>
  </body>
  <script is:inline>// 1. JSONファイルの場所（S3のURLや相対パス）
  const jsonUrl = "./cow.json"; 
  const listContainer = document.getElementById("article-list");

  // 2. 非同期でデータを取得する関数
  async function displayCowList() {
    try {
      const response = await fetch(jsonUrl);
      
      if (!response.ok) {
        throw new Error("JSONの読み込みに失敗しました");
      }

      // ここで文字列が「配列データ」に変換されます
      const data = await response.json();

      // 3. データを使ってHTMLを生成
      const htmlContent = data.map(n => `
        <li>
          <strong>ID:</strong> ${n.id2} | 
          <strong>LOT:</strong> ${n.lot} | 
          <strong>品種:</strong> ${n.breed} | 
          <strong>性別:</strong> ${n.gender}
        </li>
      `).join("");

      listContainer.innerHTML = htmlContent;
      
    } catch (error) {
      console.error("エラーが発生しました:", error);
      listContainer.innerHTML = "データの読み込み中にエラーが発生しました。";
    }
  }

  // 実行
  displayCowList();
  </script>
</html>