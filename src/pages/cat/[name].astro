---
// src/pages/cat/[id].astro
import { client } from "../../lib/microcms";

// 1. カテゴリ一覧を取得して、生成するページのパス（ID）を決定する
export async function getStaticPaths() {
  const response = await client.get({ endpoint: "categories" });
  
  return response.contents.map((category: any) => ({
    params: { name: category.name },
    props: { categoryName: category.name },
  }));
}

// 2. Astro.params からカテゴリIDを取得
const { id } = Astro.params;
const { categoryName } = Astro.props;

// 3. そのカテゴリIDを「filters」に指定して、紐づく記事だけを取得する
const blogResponse = await client.get({
  endpoint: "info",
  queries: { 
    // content参照フィールド(tag)が現在のカテゴリIDと一致するものを抽出
    filters: `tag[equals]${id}` 
  },
});
---

<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>{categoryName}の一覧</title>
</head>
<body>
  <h1>「{categoryName}」の記事一覧</h1>
  <ul>
    {
      blogResponse.contents.map((post: any) => (
        <li>
          <a href={`/info/${post.id}`}>
            {post.title}
          </a>
        </li>
      ))
    }
  </ul>
  
  {blogResponse.contents.length === 0 && <p>記事がありません。</p>}
  
  <a href="/">トップへ戻る</a>
</body>
</html>