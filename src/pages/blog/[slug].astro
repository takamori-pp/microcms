---
// src/pages/blog/[id].astro
import { client } from "../../lib/microcms";

// 1. 全記事のIDを取得して、どのURL（ページ）を作るかAstroに教える
export async function getStaticPaths() {
  const response = await client.get({ endpoint: "info" });
  return response.contents.map((content: any) => ({
    params: { slug: content.slug },
    props: { post: content },
  }));
}

// 2. 特定の記事の本文を取得する
const { post } = Astro.props;
---

<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="/th_test/microcms/css/style.css">
</head>
  <body>
    <div class="inner">
      <h1>{post.title}</h1>
      <article set:html={post.content} />
      <h2>繰り返しフィールド</h2>
      <div class="goods c-flex p-flyer__flex">
        {post.goods && post.goods.map((item :any) => (
          <div class="goods-item p-flyer__box">
            {item.img && <img src={item.img.url} alt={item.name} width="200" />}
            <h3>{item.name}</h3>
            <p>{item.price}</p>
            <p>{item.discription}</p>
          </div>
        ))}
      </div>
      <div class="contents">
        {
          post.contents && post.contents.map((content: any) => {
            // contents01: リッチエディタ
            if (content.fieldId === 'contents01') {
              return (
                <div class="custom-field-01" set:html={content.richeditor} />
              );
            }

            // contents02: HTMLとCSS
            if (content.fieldId === 'contents02') {
              return (
                <>
                  {/* CSSがある場合はstyleタグを展開 */}
                  {content.css && <style set:html={content.css} />}
                  <div class="custom-field-02" set:html={content.html} />
                </>
              );
            }

            return null;
          })
        }
      </div>
      <article set:html={post.test2} />
    </div>
    
    <footer id="footer"></footer>
    <script src="./script/script.js" is:inline></script>
  </body>
</html>